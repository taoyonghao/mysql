{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">ğŸ“Š æ•°æ®åº“çŠ¶æ€æŸ¥çœ‹ï¼ˆæ¼”ç¤ºç”¨ï¼‰</h2>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <div class="mb-4">
        <div class="alert alert-info">
            <h5><i class="fas fa-database me-2"></i>æ•°æ®åº“æ“ä½œæ¼”ç¤º</h5>
            <p>è¿™ä¸ªé¡µé¢ç”¨äºå‘è€å¸ˆå±•ç¤ºæ•°æ®åº“çš„å®æ—¶å˜åŒ–ã€‚å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
            <div class="d-flex gap-2">
                <a href="{{ url_for('add_record') }}" class="btn btn-success">
                    <i class="fas fa-plus me-1"></i>æ·»åŠ æ–°è®°å½•ï¼ˆCreateï¼‰
                </a>
                <a href="{{ url_for('admin_reset_data') }}" 
                   class="btn btn-danger"
                   onclick="return confirm('âš ï¸ è¿™å°†æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·å’Œè®°å½•ï¼Œä»…ç”¨äºæ¼”ç¤ºï¼ç¡®å®šç»§ç»­å—ï¼Ÿ')">
                    <i class="fas fa-trash-alt me-1"></i>æ¸…ç©ºæ•°æ®ï¼ˆæ¼”ç¤ºé‡æ–°å¼€å§‹ï¼‰
                </a>
                <a href="{{ url_for('dashboard') }}" class="btn btn-primary">
                    <i class="fas fa-home me-1"></i>è¿”å›ç³»ç»Ÿ
                </a>
            </div>
        </div>
    </div>
    
    <!-- æ˜¾ç¤ºæ‰€æœ‰è¡¨çš„æ•°æ® -->
    {% for table_name, data in table_data.items() %}
    <div class="card mb-4">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-table me-2"></i>{{ table_name }} è¡¨
                <span class="badge bg-light text-dark ms-2">{{ data|length }} æ¡è®°å½•</span>
            </h5>
            <button class="btn btn-sm btn-outline-light" type="button" 
                    data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}">
                æ˜¾ç¤º/éšè—
            </button>
        </div>
        <div class="collapse show" id="collapse{{ loop.index }}">
            <div class="card-body">
                {% if data %}
                <div class="table-responsive">
                    <table class="table table-bordered table-hover table-sm">
                        <thead class="table-light">
                            <tr>
                                {% for column in data[0].keys() %}
                                <th>{{ column }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in data %}
                            <tr>
                                {% for value in row.values() %}
                                <td>
                                    {% if value is none %}
                                        <span class="text-muted">NULL</span>
                                    {% else %}
                                        {{ value }}
                                    {% endif %}
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-3 text-muted">
                    <i class="fas fa-database fa-2x mb-2"></i>
                    <p>è¡¨ä¸­æ²¡æœ‰æ•°æ®</p>
                </div>
                {% endif %}
                
                <!-- è¡¨ç»“æ„ä¿¡æ¯ -->
                <div class="mt-3">
                    <button class="btn btn-outline-secondary btn-sm" type="button" 
                            data-bs-toggle="collapse" data-bs-target="#structure{{ loop.index }}">
                        æŸ¥çœ‹è¡¨ç»“æ„
                    </button>
                    <div class="collapse mt-2" id="structure{{ loop.index }}">
                        <div class="card card-body">
                            <pre><code>{% for column in data[0].keys() %}{{ column }}{% if not loop.last %}, {% endif %}{% endfor %}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    
    <!-- æ•°æ®åº“ä¿¡æ¯æ€»ç»“ -->
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>æ•°æ®åº“ä¿¡æ¯æ€»ç»“</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="card bg-light mb-3">
                        <div class="card-body">
                            <h6 class="card-title">è¡¨æ•°é‡</h6>
                            <h3 class="text-primary">{{ table_data|length }}</h3>
                            <small class="text-muted">users, categories, records</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-light mb-3">
                        <div class="card-body">
                            <h6 class="card-title">æ€»è®°å½•æ•°</h6>
                            <h3 class="text-success">
                                {% set total = 0 %}
                                {% for table_name, data in table_data.items() %}
                                    {% set total = total + data|length %}
                                {% endfor %}
                                {{ total }}
                            </h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-light mb-3">
                        <div class="card-body">
                            <h6 class="card-title">æ•°æ®å¤§å°</h6>
                            <h3 class="text-warning">å®æ—¶</h3>
                            <small class="text-muted">æ¯æ¬¡æ“ä½œç«‹å³æ›´æ–°</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .table th {
        background-color: #f8f9fa;
        font-weight: 600;
    }
    pre {
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        margin: 0;
    }
    .collapse.show {
        animation: fadeIn 0.3s;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
</style>
{% endblock %}